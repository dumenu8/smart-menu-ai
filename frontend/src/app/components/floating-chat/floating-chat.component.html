<!-- Floating Action Button (Always Visible) -->
<button (click)="toggleChat()"
    class="fixed bottom-6 right-6 z-50 w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 hover:scale-110 active:scale-95 shadow-lg shadow-purple-500/30 flex items-center justify-center text-white transition-all duration-300 animate-in scale-in zoom-in duration-200"
    [title]="isOpen() ? 'Close Chat' : 'Open Chat'">
    <span class="material-icons text-3xl">{{ isOpen() ? 'close' : 'chat' }}</span>
</button>

<!-- Floating Chat Window -->
@if (isOpen()) {
<div
    class="fixed bottom-24 right-6 w-96 h-[600px] z-50 rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-gray-900 animate-in fade-in slide-in-from-bottom-10 duration-300 flex flex-col">

    <!-- Header -->
    <div class="p-4 bg-gray-800 border-b border-gray-700 flex justify-between items-center shrink-0">
        <div>
            <h3 class="font-bold text-white flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                AI Concierge
            </h3>
        </div>
        <button (click)="toggleChat()"
            class="text-gray-400 hover:text-red-400 transition-colors p-1 rounded hover:bg-gray-700">
            <span class="material-icons text-sm">close</span>
        </button>
    </div>

    <!-- Messages Area -->
    <div #scrollContainer class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth">

        <!-- Welcome Message -->
        <div class="flex justify-start">
            <div
                class="bg-gray-800 text-gray-200 px-4 py-2 rounded-2xl rounded-tl-none max-w-[85%] shadow-md border border-gray-700">
                <p>Hello! I'm your dining assistant. Ask me anything about the menu! üç∑</p>
            </div>
        </div>

        @for (msg of messages(); track $index) {
        <div class="flex" [ngClass]="{'justify-end': msg.isUser, 'justify-start': !msg.isUser}">
            @if (!msg.isUser) {
            <div
                class="bg-gray-800 text-gray-200 px-4 py-2 rounded-2xl rounded-tl-none max-w-[85%] shadow-md border border-gray-700 animate-in fade-in slide-in-from-left-2 duration-300">
                <p class="whitespace-pre-wrap">{{ msg.text }}<span *ngIf="msg.isTyping" class="animate-pulse">_</span>
                </p>
            </div>
            }

            @if (msg.isUser) {
            <div
                class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-2xl rounded-tr-none max-w-[85%] shadow-md animate-in fade-in slide-in-from-right-2 duration-300">
                <p>{{ msg.text }}</p>
            </div>
            }
        </div>
        }
    </div>

    <!-- Input Area -->
    <div class="p-4 bg-gray-900 border-t border-gray-800">
        <div class="relative">
            <input type="text" [(ngModel)]="userInput" (keydown.enter)="sendMessage()" placeholder="Ask something..."
                class="w-full bg-gray-800 text-white rounded-full pl-4 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 border border-gray-700 placeholder-gray-500 transition-all shadow-inner">

            <button (click)="sendMessage()" [disabled]="!userInput()"
                class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-blue-600 hover:bg-blue-500 text-white flex items-center justify-center disabled:opacity-50 disabled:bg-gray-600 transition-all cursor-pointer">
                ‚Üó
            </button>
        </div>
    </div>

</div>
}